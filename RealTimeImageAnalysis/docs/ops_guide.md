# 運用・デプロイ設計書

---

## 1.監視／アラート設計

### 1.1 取得メトリクス一覧

| メトリクス       | 収集先               | 頻度         | 用途               |
| :--------------- | :------------------- | :----------- | :----------------- |
| レスポンスタイム | Application Insights | 1 分毎       | SLA 遵守確認       |
| エラー率         | Application Insights | リアルタイム | 障害検知           |
| CPU 使用率       | Azure Monitor        | 5 分毎       | スケーリング判断用 |
| メモリ使用量     | Azure Monitor        | 5 分毎       | リソース逼迫監視   |

### 1.2 アラートルール

| アラート名      | 条件                | 通知チャネル | 備考             |
| :-------------- | :------------------ | :----------- | :--------------- |
| High Error Rate | エラー率 > 5%       | Email, Teams | 即時通知         |
| Slow Response   | P95 レイテンシ > 1s | PagerDuty    | SLA 違反対応     |
| High CPU Usage  | CPU 使用率 > 80%    | Email        | 自動スケール検討 |

---

## 2. 運用手順／トラブル対応

### 2.1 障害エスカレーションフロー

1. アラート受信 → 1st 対応担当者アラート
2. 30 分以内に対応状況を更新
3. 1 時間以内に根本原因分析（RCA）
4. 必要に応じて 2nd チームへエスカレーション

### 2.2 リリース手順

1. PR マージ（main ブランチ）
2. CI/CD による自動デプロイ開始
3. Staging で Smoke Test 実施
4. 自動 Blue-Green スワップ（Production）
5. Post-Deployment Smoke Test
6. 完了報告

### 2.3 ロールバック手順

- 問題発生時、Azure Portal または CLI で前バージョンスロットへスワップ

### 2.4 定期メンテナンス項目

- Key Vault のシークレット有効期限確認（月次）
- Azure リソースのコストレポート確認（月次）
- セキュリティパッチ適用 （四半期）

---
